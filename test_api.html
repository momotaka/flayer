<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>API デバッグテスト</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        pre { background: #f0f0f0; padding: 10px; overflow: auto; }
        button { padding: 10px 20px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Flayer API デバッグ</h1>
    
    <button onclick="testDebug()">1. デバッグ情報を取得</button>
    <pre id="debug-result"></pre>
    
    <button onclick="testChat()">2. チャットAPIをテスト</button>
    <pre id="chat-result"></pre>
    
    <script>
    async function testDebug() {
        const result = document.getElementById('debug-result');
        result.textContent = '読み込み中...';
        
        try {
            const response = await fetch('debug.php');
            const data = await response.text();
            result.textContent = data;
        } catch (error) {
            result.textContent = 'エラー: ' + error.message;
        }
    }
    
    async function testChat() {
        const result = document.getElementById('chat-result');
        result.textContent = '読み込み中...';
        
        try {
            const response = await fetch('chat.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: 'こんにちは',
                    context: {
                        currentQuestionIndex: 0,
                        answers: {},
                        questions: [],
                        isStart: false,
                        serviceOverview: null
                    }
                })
            });
            
            const text = await response.text();
            result.textContent = `Status: ${response.status}\n\n${text}`;
            
            // JSONとしてパースを試みる
            try {
                const data = JSON.parse(text);
                result.textContent += '\n\nParsed JSON:\n' + JSON.stringify(data, null, 2);
            } catch (e) {
                // JSONパースエラーは無視
            }
        } catch (error) {
            result.textContent = 'エラー: ' + error.message;
        }
    }
    </script>
</body>
</html>